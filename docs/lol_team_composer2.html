<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>LoL Team Composer</title>
</head>
<body>
    <h1>Test LoL Team Composer</h1>
    <div id="results" style="font-family: sans-serif;"></div>

    <script>
        let winrateData = {}, synergyData = {};

        async function loadCSV(path) {
            const response = await fetch(path);
            const text = await response.text();
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const entry = {};
                headers.forEach((h, i) => entry[h.trim()] = values[i]?.trim());
                return entry;
            });
        }

        async function loadData() {
            const winrate = await loadCSV('static/predicted_champion_winrates.csv');
            const synergy = await loadCSV('static/pair_winrate_predictions_with_embeddings.csv');

            winrate.forEach(row => {
                winrateData[row.Champion] = parseFloat(row.Predicted_Winrate);
            });

            synergy.forEach(row => {
                const key = [row.Champion_1, row.Champion_2].sort().join('|');
                synergyData[key] = parseFloat(row.Predicted_Winrate);
            });

            runTestAnalysis();
        }

        function getChampionWinrate(champ) {
            return winrateData[champ] ?? 0.5;
        }

        function getPairSynergy(c1, c2) {
            const key = [c1, c2].sort().join('|');
            return synergyData[key] ?? ((getChampionWinrate(c1) + getChampionWinrate(c2)) / 2 - 0.01);
        }

        function getTeamScore(team) {
            const winrates = team.map(getChampionWinrate);
            const avgWinrate = winrates.reduce((a, b) => a + b, 0) / team.length;

            const synergies = [];
            for (let i = 0; i < team.length; i++) {
                for (let j = i + 1; j < team.length; j++) {
                    synergies.push(getPairSynergy(team[i], team[j]));
                }
            }
            const avgSynergy = synergies.reduce((a, b) => a + b, 0) / synergies.length;

            return {
                winrate: avgWinrate,
                synergy: avgSynergy,
                overall: (0.5 * avgWinrate + 0.3 * avgSynergy).toFixed(3)
            };
        }

        function runTestAnalysis() {
            const team = ['Aatrox', 'Ahri', 'Jinx', 'Thresh', 'Graves'];
            const scores = getTeamScore(team);
            const container = document.getElementById('results');
            container.innerHTML = `
                <h2>RÃ©sultat de test :</h2>
                <p>Winrate moyen : ${(scores.winrate * 100).toFixed(1)}%</p>
                <p>Synergie moyenne : ${scores.synergy.toFixed(3)}</p>
                <p>Score global : ${scores.overall}</p>
            `;
        }

        window.onload = () => {
            loadData();
        };
    </script>
</body>
</html>
