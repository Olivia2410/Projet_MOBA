<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Team Composer</title>
    <style>
        /* ... ton CSS existant ici, inchangÃ© ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ... ton HTML existant ici, inchangÃ© ... -->
    </div>

    <script>
        // === Chargement des donnÃ©es CSV ===
        let winrateData = {}, synergyData = {}, roleData = {};

        async function loadCSV(path) {
            const response = await fetch(path);
            const text = await response.text();
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const entry = {};
                headers.forEach((h, i) => entry[h.trim()] = values[i]?.trim());
                return entry;
            });
        }

        async function loadData() {
            const winrate = await loadCSV('static/predicted_champion_winrates.csv');
            const synergy = await loadCSV('static/pair_winrate_predictions_with_embeddings.csv');
            const roles = await loadCSV('static/champion_roles.csv');

            winrate.forEach(row => {
                winrateData[row.Champion] = parseFloat(row.Predicted_Winrate);
            });

            synergy.forEach(row => {
                const key = [row.Champion_1, row.Champion_2].sort().join('|');
                synergyData[key] = parseFloat(row.Predicted_Winrate);
            });

            roles.forEach(row => {
                roleData[row.champion] = row.roles.split(',').map(r => r.trim().toLowerCase());
            });
        }

        function getChampionWinrate(champ) {
            return winrateData[champ] ?? 0.5;
        }

        function getPairSynergy(c1, c2) {
            const key = [c1, c2].sort().join('|');
            return synergyData[key] ?? ((getChampionWinrate(c1) + getChampionWinrate(c2)) / 2 - 0.01);
        }

        function getTeamScore(team) {
            const winrates = team.map(getChampionWinrate);
            const avg_winrate = winrates.reduce((a, b) => a + b, 0) / winrates.length;
            let synergies = [];
            for (let i = 0; i < team.length; i++) {
                for (let j = i + 1; j < team.length; j++) {
                    synergies.push(getPairSynergy(team[i], team[j]));
                }
            }
            const avg_synergy = synergies.length ? synergies.reduce((a, b) => a + b, 0) / synergies.length : 0.5;
            return {
                winrate: avg_winrate,
                synergy: avg_synergy,
                overall: (0.5 * avg_winrate + 0.3 * avg_synergy).toFixed(3)
            };
        }

        function formatImageName(champ) {
            const lowerList = ['aatrox', 'alistar', 'akshan', 'ahri', 'akali', 'ambessa'];
            return lowerList.includes(champ.toLowerCase()) ? `${champ.toLowerCase()}.jpg` : `${champ}.jpg`;
        }

        // Appelle loadData au dÃ©marrage pour prÃ©charger les donnÃ©es
        loadData();

        // Modifie la fonction simulateAnalysis pour intÃ©grer les vraies donnÃ©es
        function simulateAnalysis(teamData, enemyData, strategy) {
            const roles = ['Top', 'Jungle', 'Mid', 'ADC', 'Support'];
            const composition = [];
            const selectedChamps = [];

            roles.forEach(role => {
                const candidates = teamData[role] || ['Aatrox'];
                const selected = candidates[0];
                composition.push({ role, champion: selected });
                selectedChamps.push(selected);
            });

            const scores = getTeamScore(selectedChamps);

            return {
                composition,
                scores: {
                    teamScore: scores.overall,
                    avgWinrate: scores.winrate,
                    avgSynergy: scores.synergy,
                    counterAdvantage: enemyData.length ? (Math.random() * 0.4 - 0.2).toFixed(3) : null,
                    overallScore: scores.overall
                },
                criteria: getStrategyCriteria(strategy)
            };
        }

        // Ajout des images dans displayResults
        function displayResults(recommendations) {
            const results = document.getElementById('results');

            results.innerHTML = `
                <h3 style="color: #c8aa6e; margin-bottom: 20px;">
                    ðŸŽ¯ Recommandation basÃ©e sur : ${recommendations.criteria}
                </h3>

                <div class="recommendation-card">
                    <h4 style="color: #f0e6d2; margin-bottom: 15px;">ðŸ’« Composition RecommandÃ©e</h4>

                    <div class="composition-display">
                        ${recommendations.composition.map(item => `
                            <div class="role-champion">
                                <div class="role-name">${item.role}</div>
                                <img src="img/${formatImageName(item.champion)}" alt="${item.champion}" style="width:60px; border-radius:8px; margin-bottom:8px;">
                                <div class="champion-name">${item.champion}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="scores">
                        <div class="score-item">
                            <div class="score-label">Score d'Ã‰quipe</div>
                            <div class="score-value">${recommendations.scores.teamScore}</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Winrate Moyen</div>
                            <div class="score-value">${(recommendations.scores.avgWinrate * 100).toFixed(1)}%</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Synergie Moyenne</div>
                            <div class="score-value">${recommendations.scores.avgSynergy.toFixed(3)}</div>
                        </div>
                        ${recommendations.scores.counterAdvantage !== null ? `
                            <div class="score-item">
                                <div class="score-label">Avantage Counter</div>
                                <div class="score-value">${recommendations.scores.counterAdvantage}</div>
                            </div>
                        ` : ''}
                        <div class="score-item">
                            <div class="score-label">Score Global</div>
                            <div class="score-value" style="color: #c8aa6e;">${recommendations.scores.overallScore}</div>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
